
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>rbcodes.GUIs.rb_test &#8212; rbcodes 0.1.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">rbcodes 0.1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rbcodes.GUIs.rb_test</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for rbcodes.GUIs.rb_test</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splrep</span><span class="p">,</span><span class="n">splev</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">medfilt</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">Box1DKernel</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">loadtxt</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">resource_filename</span>
<span class="kn">import</span> <span class="nn">PySimpleGUI</span> <span class="k">as</span> <span class="nn">sg</span>
<span class="kn">from</span> <span class="nn">IGM</span> <span class="kn">import</span> <span class="n">rb_setline</span> <span class="k">as</span> <span class="n">line</span>       
<span class="kn">import</span> <span class="nn">ipdb</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<div class="viewcode-block" id="rb_plot_spec"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec">[docs]</a><span class="k">class</span> <span class="nc">rb_plot_spec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">=</span><span class="n">wave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">=</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span><span class="o">=</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">=</span><span class="n">error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span><span class="n">zabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="c1"># Initializing a label</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span>

        <span class="n">spectrum</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
        <span class="n">xr</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">)]</span>
        <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>

        <span class="c1">#create indentified line list</span>
        <span class="c1"># Very basic window.  Return values using auto numbered keys</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;zabs&#39;</span><span class="p">:[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="s1">&#39;List&#39;</span><span class="p">:[</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">],</span> <span class="s1">&#39;color&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">]}</span> 
        <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">=</span><span class="n">df</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ontype</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<div class="viewcode-block" id="rb_plot_spec.ontype"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.ontype">[docs]</a>    <span class="k">def</span> <span class="nf">ontype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">zabs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> 
        <span class="c1"># when the user hits &#39;r&#39;: clear the axes and plot the original spectrum</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
            <span class="n">xr</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">)]</span>
            <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    
        <span class="c1"># Set top y max</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;Z&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing to see if we can get a pop up window to work&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_redshift</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;j&#39;</span><span class="p">:</span>
            <span class="n">lambda_rest</span><span class="p">,</span> <span class="n">LineList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identify_line_GUI</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">lambda_rest</span><span class="p">,</span><span class="n">LineList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span><span class="n">lambda_rest</span><span class="p">)</span><span class="o">/</span><span class="n">lambda_rest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">LineList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target Redshfit set at : &#39;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>

        <span class="c1"># Manage and plot multiple absorbers</span>
        <span class="c1">#Clunky GUI to plot lines</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;K&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_identified_absorbers</span><span class="p">()</span>


        <span class="c1"># Set top y min</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


        <span class="c1"># Smooth spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">Filter_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span><span class="c1">#medfilt(flux,np.int(Filter_size))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1">#Unsmooth Spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;U&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">Filter_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span><span class="c1">#medfilt(flux,np.int(Filter_size))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c1"># Set X max</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="c1"># Set x min</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


        <span class="c1"># Set pan spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;]&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">delx</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delx</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># Set pan spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;[&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">delx</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">delx</span><span class="p">,</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># Compute Equivalent Width between two points</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="c1">#ekeycounts +=1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

    
            <span class="c1"># Keep running tab of all E clicks</span>
            <span class="n">eclick</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">);</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EW_pt&#39;</span><span class="p">,</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            

           




            <span class="k">if</span> <span class="n">eclick</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Check if the wave entries are monotonously increasing</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>


                <span class="n">EW</span><span class="p">,</span><span class="n">sig_EW</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">wave_slice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">[</span><span class="n">tab</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
                <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                <span class="n">sig_EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
                <span class="c1">#ipdb.set_trace()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------- Equivalent Width -------------------------------------&#39;</span><span class="p">)</span>
                <span class="n">Wval</span><span class="o">=</span><span class="s1">&#39;EW [mAA]: &#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EW</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sig_EW</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">Wval</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Wval</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------------&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


    
                <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>

        
        <span class="c1"># Fit a Gaussian</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
    
            <span class="n">fclick</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">)</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EW_pt&#39;</span><span class="p">,</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1">#Start Fitting</span>
            <span class="k">if</span> <span class="n">fclick</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="c1"># First fit a quick continuum</span>
                <span class="n">qtq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">ww</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">)</span>                 
                <span class="n">flux1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>
                <span class="n">spline</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">continuum</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">spline</span><span class="p">)</span>
    
                <span class="c1"># Check if it is an absorption or emission line</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="mf">1.</span><span class="o">-</span> <span class="p">(</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span><span class="p">)</span>
                    <span class="n">gmodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">gmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ydata</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">ww</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">wid</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">Final_fit</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">best_fit</span><span class="p">)</span><span class="o">*</span><span class="n">continuum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="p">(</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span><span class="p">)</span>
                    <span class="n">gmodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">gmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ydata</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">ww</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">wid</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">Final_fit</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">best_fit</span><span class="o">*</span><span class="n">continuum</span>         
    
    
                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">())</span>
                <span class="n">model_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">Final_fit</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gaussian Fit&quot;</span><span class="p">)</span>
    
                <span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>
         <span class="c1"># Making sure any drawn line list remains drawn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

       

<div class="viewcode-block" id="rb_plot_spec.DrawLineList"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.DrawLineList">[docs]</a>    <span class="k">def</span> <span class="nf">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">label</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>                   
            <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

            <span class="c1"># Now make a smaller linelist within the current xaxes range.</span>

            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>


            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
                    <span class="n">xdata</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)]</span>
                    <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.9</span><span class="p">))</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,)</span>                    
                    <span class="n">tt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
        <span class="c1">#print(&#39;Target Redshfit set at : &#39; + np.str(self.zabs))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
    <span class="c1">#This code will draw any linelist identified</span>
    
<div class="viewcode-block" id="rb_plot_spec.draw_any_linelist"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.draw_any_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">draw_any_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Now make a smaller linelist within the current xaxes range.</span>
        <span class="c1">#plt.figure(self.fig.number)</span>
        <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="c1">#Hardcoding that only 10 independent absorber systems can be plotted</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                <span class="n">zabs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">linelist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;List&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lineclr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

                <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="n">linelist</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
                        <span class="n">xdata</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">),</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zabs</span><span class="p">)]</span>
                        <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.9</span><span class="p">))</span>
                        <span class="n">ydata</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="n">lineplot_list</span><span class="p">,</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">lineclr</span><span class="p">)</span>                    
                        <span class="n">tt_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
        <span class="c1">#print(&#39;Target Redshfit set at : &#39; + np.str(self.zabs))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="rb_plot_spec.manage_identified_absorbers"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.manage_identified_absorbers">[docs]</a>    <span class="k">def</span> <span class="nf">manage_identified_absorbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">ChangeLookAndFeel</span><span class="p">(</span><span class="s1">&#39;Dark&#39;</span><span class="p">)</span>   
        <span class="n">col1</span><span class="o">=</span><span class="p">[</span> <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;1. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;2. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;3. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;4. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;5. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;6. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;7. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;8. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;9. zabs&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;10. zabs&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;zabs&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]),</span>  <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]]</span>

        <span class="n">col2</span><span class="o">=</span> <span class="p">[[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)]]</span>



        <span class="n">col3</span><span class="o">=</span>  <span class="p">[[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]]</span>
    



        <span class="n">layout</span> <span class="o">=</span> <span class="p">[[</span><span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">col2</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">col3</span><span class="p">)],</span> <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Submit</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Exit</span><span class="p">(),</span><span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">)]]</span>


        <span class="n">window</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;Update Selected Absorbers&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1">#update database</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;zabs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;List&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">20</span><span class="p">]</span>   
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_any_linelist</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">sg</span><span class="o">.</span><span class="n">WIN_CLOSED</span> <span class="ow">or</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Exit&#39;</span><span class="p">:</span> 
                <span class="k">break</span> 
            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span><span class="s1">&#39;Reset&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
        <span class="n">window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
 






<div class="viewcode-block" id="rb_plot_spec.plot_keystroke"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.plot_keystroke">[docs]</a>    <span class="k">def</span> <span class="nf">plot_keystroke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">xdata</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
        <span class="n">ydata</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">test</span><span class="p">,</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;r+&#39;</span><span class="p">,)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>



<div class="viewcode-block" id="rb_plot_spec.set_redshift"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.set_redshift">[docs]</a>    <span class="k">def</span> <span class="nf">set_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zabs</span><span class="p">,</span><span class="n">LineList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_redshift_GUI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">zabs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">LineList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target Redshfit set at : &#39;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
        <span class="c1">#xdata = self.wave/(1.+np.double(text))</span>
        <span class="c1">#self.spectrum.set_xdata(xdata)</span>
        <span class="c1">#self.ax.set_xlim(np.min(xdata), np.max(xdata))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="rb_plot_spec.identify_line_GUI"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.identify_line_GUI">[docs]</a>    <span class="k">def</span> <span class="nf">identify_line_GUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LLS Small&#39;</span>
        <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">Transition_List</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">wavelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">Transition_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">])</span>
            <span class="n">wavelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">])</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Please select the transition and LineList&#39;</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">Transition_List</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;_Transition_&#39;</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;_Menu_&#39;</span><span class="p">)],</span> 
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">)]]</span>


        <span class="n">window</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;Line Identification&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  


        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>             <span class="c1"># Event Loop  </span>
            <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>  

            <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Submit&#39;</span><span class="p">:</span>  
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;_Menu_&#39;</span><span class="p">]</span>  
            <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">Transition_List</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">wavelist</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">Transition_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">])</span>
                <span class="n">wavelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">])</span>
            <span class="n">window</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;_Transition_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">Transition_List</span><span class="p">)</span>  
        <span class="n">window</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>



        <span class="n">Transition_List</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Transition_List</span><span class="p">)</span>
        <span class="n">wavelist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelist</span><span class="p">)</span>

        <span class="n">Transition_rest</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;_Transition_&#39;</span><span class="p">]</span>
        <span class="n">qq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Transition_List</span><span class="o">==</span><span class="n">Transition_rest</span><span class="p">)</span>
        <span class="c1">#ipdb.set_trace()</span>
        <span class="n">lambda_rest</span><span class="o">=</span><span class="n">wavelist</span><span class="p">[</span><span class="n">qq</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">LineList</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;_Menu_&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lambda_rest</span><span class="p">,</span><span class="n">LineList</span></div>






<div class="viewcode-block" id="rb_plot_spec.set_redshift_GUI"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.set_redshift_GUI">[docs]</a>    <span class="k">def</span> <span class="nf">set_redshift_GUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Please enter the desired redshift, LineList&#39;</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Redshift&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sg</span><span class="o">.</span><span class="n">InputText</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;LineList&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span> <span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span> <span class="s1">&#39;DLA&#39;</span><span class="p">),</span> <span class="n">auto_size_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span> 
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Submit</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Cancel</span><span class="p">()]]</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;Redshift Query&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>   
        <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>
        <span class="n">window</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="n">zabs</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">LineList</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">zabs</span><span class="p">,</span><span class="n">LineList</span></div>


<div class="viewcode-block" id="rb_plot_spec.specplot"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.specplot">[docs]</a>    <span class="k">def</span> <span class="nf">specplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">xlim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span></div>


    
<div class="viewcode-block" id="rb_plot_spec.compute_EW"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.rb_plot_spec.compute_EW">[docs]</a>    <span class="k">def</span> <span class="nf">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="n">flx</span><span class="p">,</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">err_flx</span><span class="p">):</span>
        <span class="n">qtq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span> <span class="n">lam</span> <span class="o">&gt;=</span> <span class="n">lam_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">lam</span> <span class="o">&lt;=</span> <span class="n">lam_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">ww</span><span class="o">=</span><span class="n">lam</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>                 
        <span class="n">flux1</span><span class="o">=</span><span class="n">flx</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>
        <span class="n">spline</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">continuum</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">spline</span><span class="p">)</span>
        <span class="c1">#ax.plot(ww,continuum,&#39;k--&#39;)</span>
        <span class="n">sig_flx1</span><span class="o">=</span><span class="n">err_flx</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span><span class="o">/</span><span class="n">continuum</span>
        <span class="n">flux1</span><span class="o">=</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span>
    
        <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">flux1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">ww</span><span class="p">)</span>
        <span class="n">delw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">ww</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ww</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sig_w</span><span class="o">=</span><span class="n">delw</span><span class="o">*</span><span class="n">sig_flx1</span>
        <span class="n">sig_wtot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sig_w</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">EW</span><span class="p">,</span><span class="n">sig_wtot</span><span class="p">,</span><span class="n">continuum</span><span class="p">,</span><span class="n">ww</span></div></div>








    
<div class="viewcode-block" id="gaussian"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.rb_test.gaussian">[docs]</a><span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">cen</span><span class="p">,</span> <span class="n">wid</span><span class="p">):</span>
    <span class="s2">&quot;1-d gaussian: gaussian(x, amp, cen, wid)&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amp</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">wid</span><span class="p">))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">cen</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">wid</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
    
    
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">rbcodes 0.1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rbcodes.GUIs.rb_test</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Rongmon Bordoloi.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>