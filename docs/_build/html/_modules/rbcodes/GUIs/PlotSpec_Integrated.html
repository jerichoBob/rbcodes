
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>rbcodes.GUIs.PlotSpec_Integrated &#8212; rbcodes 0.1.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">rbcodes 0.1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rbcodes.GUIs.PlotSpec_Integrated</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for rbcodes.GUIs.PlotSpec_Integrated</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splrep</span><span class="p">,</span><span class="n">splev</span>
<span class="kn">from</span> <span class="nn">IGM</span> <span class="kn">import</span> <span class="n">rb_setline</span> <span class="k">as</span> <span class="n">line</span>   
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fitting</span>    
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">rb_utility</span> <span class="k">as</span> <span class="n">rt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Qt5Agg&#39;</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.9</span>
<span class="n">clr</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rb_set_color</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span><span class="n">QHBoxLayout</span><span class="p">,</span><span class="n">QFileDialog</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QInputDialog</span><span class="p">,</span><span class="n">QListWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QListWidgetItem</span><span class="p">,</span><span class="n">QLabel</span><span class="p">,</span><span class="n">QTableWidget</span><span class="p">,</span><span class="n">QGridLayout</span><span class="p">,</span><span class="n">QMessageBox</span><span class="p">,</span><span class="n">QBoxLayout</span><span class="p">,</span><span class="n">QDesktopWidget</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QPalette</span><span class="p">,</span> <span class="n">QColor</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">resource_filename</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">Box1DKernel</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FigureCanvasQTAgg</span><span class="p">,</span>
    <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">GUIs</span> <span class="kn">import</span> <span class="n">guess_abs_line_vel_gui</span> <span class="k">as</span> <span class="n">g</span>
<span class="kn">from</span> <span class="nn">GUIs.abstools</span> <span class="kn">import</span> <span class="n">Absorber</span> <span class="k">as</span> <span class="n">A</span> 



<span class="n">HELP</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        MAIN GUI HELP:</span>
<span class="s1">        Left Widget is the absorber manager. Here you can add known absorbers, guess absorbers</span>
<span class="s1">        and plot or hide the transition lines. If an absorber is determined to be incorrect, removing </span>
<span class="s1">        the abosrber will delete it from the manager and it will not exist in the output csv file once saving</span>
<span class="s1">        </span>
<span class="s1">        The main canvas is where all following keyboard events are tied to. If interacting with another </span>
<span class="s1">        widget outside of the canvas, must reclick within the canvas to enable the keyboard events</span>
<span class="s1">        </span>
<span class="s1">        The active zabs manager (below canvas) will display what redshift is currently being used</span>
<span class="s1">        for identifying matching transitions. The Catalog button will automatically add this transition </span>
<span class="s1">        to the absorber manager</span>
<span class="s1">        </span>
<span class="s1">        --------------Keyboard Events----------</span>
<span class="s1">        </span>
<span class="s1">        &#39;r&#39;:   resets/clears the axes and replots the spectra</span>
<span class="s1">        &#39;R&#39;:   Keeps the spectra active and will remove all lines/text from the canvas</span>
<span class="s1">        &#39;t&#39;:   Will restrict the ymax of the canvas to the users current mouse height</span>
<span class="s1">        &#39;b&#39;:   Restricts ymin of the canvas to current mouse height</span>
<span class="s1">        &#39;S&#39;:   Smoothes the spectra</span>
<span class="s1">        &#39;U&#39;:   Unsmooth spectra</span>
<span class="s1">        &#39;x&#39;:   Sets left x limit (xmin)</span>
<span class="s1">        &#39;X&#39;:   Sets right x limit (xmax)</span>
<span class="s1">        &#39;]&#39;:   Shifts canvas to the right</span>
<span class="s1">        &#39;[&#39;:   Shifts canvas to the left</span>
<span class="s1">        &#39;Y&#39;:   User can input their own y limits</span>
<span class="s1">        &#39;E&#39;:   Two E keystrokes will compute rest frame equivalent width at a defined region</span>
<span class="s1">        &#39;G&#39;:   Three keystrokes to fit a Gaussian profile. [Currently not drawing on the spectrum]</span>

<span class="s1">        &#39;H&#39;:   Help Window</span>
<span class="s1">        &#39;v&#39;:   Opens Separate Vstack GUI for the user to identify detected transitions</span>
<span class="s1">               Vstack commands will be discussed below</span>
<span class="s1">        </span>
<span class="s1">        &#39;j&#39;:   Designed to be used by zooming into a small region of the spectra,</span>
<span class="s1">               finding an absortion region, put mouse in the middle of that region.</span>
<span class="s1">               &#39;j&#39; then opens a transition list window for the user to select which</span>
<span class="s1">               ion they believe the abosrber is located. Once a transition is clicked,</span>
<span class="s1">               the active zabs will display what the redshift should be based on the </span>
<span class="s1">               mouse x location</span>
<span class="s1">               </span>
<span class="s1">       </span>
<span class="s1">        </span>
<span class="s1">        --------Vstack GUI Keyboard Events--------</span>
<span class="s1">        Upon pressing &#39;v&#39; in main canvas, a separate window will pop up</span>
<span class="s1">        </span>
<span class="s1">        &#39;&gt;&#39;:   Shifts page right (if more than one page)</span>
<span class="s1">        &#39;&lt;&#39;:   Shifts page left </span>
<span class="s1">        &#39;w&#39;:   Will change the transition flag between detection and Non-detection</span>
<span class="s1">        </span>
<span class="s1">        </span>
<span class="s1">        ------Notes-------</span>
<span class="s1">        Upon hitting &#39;v&#39;, the transition list will be saved. If redoing an analysis to correct</span>
<span class="s1">        or check transitions, it will identify user that the transition list has already been</span>
<span class="s1">        analyzed for the absorber. If continuing it will overwrite the previous results</span>
<span class="s1">        PLEASE NOTE, it will overwrite, not update the previous results.</span>
<span class="s1">        </span>
<span class="s1">        Save: Saving will generate its own file tree for files. Can rename a folder, but</span>
<span class="s1">            do not rename the files otherwise they will not load. Saving can be done without </span>
<span class="s1">            evaluate linelists for each absorber or with partially evaluated line lists.</span>
<span class="s1">            Saving will access the current working directory, but can change the filepath to any </span>
<span class="s1">            desired folder.</span>
<span class="s1">            </span>
<span class="s1">            The absorber manager will be saved as a .csv and the linelists saved as a .txt</span>
<span class="s1">            </span>
<span class="s1">        Load: To load, only give the parent folder, which has contents of the .csv and .txt files</span>
<span class="s1">              Loading will repopulate the previously confirmed absorber redshifts, colors, and linelist </span>
<span class="s1">              used and will plot the detected absorbers as identified during the VStack GUI.</span>
<span class="s1">               </span>
<span class="s1">        </span>

<span class="s1">        &#39;&#39;&#39;</span>

<div class="viewcode-block" id="mainWindow"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow">[docs]</a><span class="k">class</span> <span class="nc">mainWindow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span><span class="c1">#QtWidgets.QMainWindow</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="mf">2.9979e5</span> <span class="c1">#spl</span>
        <span class="c1">#initializing storing containers and variables to meet action requirements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">,</span><span class="s1">&#39;list&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;Wave_obs&#39;</span><span class="p">,</span><span class="s1">&#39;Zabs&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#zabs_line_plot and text are where the mpl line objects and text objects are stored to be removed or hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># identified_ lines and text are to store the evaluated detected absorber objects for plotting/hiding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identified_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identified_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#action variables to signify whether an event should be carried out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_remove</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#spectrum properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">=</span><span class="n">wave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">=</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span><span class="o">=</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">=</span><span class="n">error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span><span class="n">zabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#For compute_EW running tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span><span class="c1">#For compute_EW running tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;None&#39;</span> <span class="c1"># Initializing a label</span>
        
        <span class="c1">#make longer color list</span>
        <span class="n">clrlist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">clr</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">combo_options</span> <span class="o">=</span><span class="n">clrlist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span><span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span><span class="s1">&#39;DLA&#39;</span><span class="p">,</span><span class="s1">&#39;LBG&#39;</span><span class="p">,</span><span class="s1">&#39;Gal&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">]</span>
        
        <span class="c1">#---------------Initial page setup------------------# </span>
        <span class="nb">super</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Absorber Idenification&#39;</span><span class="p">)</span>
        
        <span class="c1">#Main canvas widgets</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;pale_red&#39;</span><span class="p">],</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_xlims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasQTAgg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        
        <span class="c1">#Zabs Manager Widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span> <span class="o">=</span> <span class="n">manage_identified_absorbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cellchanged</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_save</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_save</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveCatalog_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_load</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_load</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">LoadCatalog_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Identified_line_plot</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Plot Identified Lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Identified_plotter</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1">#save layout (bottom of left panel)</span>
        <span class="n">save_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">save_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_save</span><span class="p">)</span>
        <span class="n">save_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_load</span><span class="p">)</span>
        
        
        <span class="c1">#left panel Main layout</span>
        <span class="n">manage_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">manage_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">save_layout</span><span class="p">)</span>
        <span class="n">manage_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="p">)</span>
        
        <span class="c1">#canvas layout</span>
        <span class="n">plot_layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">toolbar</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span> <span class="o">=</span> <span class="n">plot_layout</span>
        
        <span class="c1"># active values widgets (bottom of main panel)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_changed</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Active Redshift&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Active LineList&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_linelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="c1"># Shows the active redshift and transition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">color_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Color&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="c1">#Message Window for user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Message Window&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : black&#39;</span><span class="p">)</span>
        
        <span class="c1">#active values layout (bottom of canvas layout)</span>
        <span class="n">active_elem_layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">active_elem_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="p">)</span>
        <span class="n">active_elem_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="p">)</span>
        <span class="n">active_elem_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">color_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="p">)</span>
        
        <span class="c1">#Catalog to connect Guessed line to the zabs manager:</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Catalog&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">catalog</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_manager</span><span class="p">())</span><span class="c1">#Catalog(self))</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Redshift_Guess</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">refresh</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Refresh&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">refresh</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Refreshed</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1">#Spacer is to reduce the size of Active redshift and transition widgets</span>
        <span class="n">spacer</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">plot_cat</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">spacerItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">active_elem_layout</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plot_cat</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
        <span class="n">plot_cat</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
        <span class="n">plot_cat</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">refresh</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">plot_cat</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacerItem</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacerItem</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacerItem</span><span class="p">)</span>
        <span class="n">plot_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">spacer</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">manage_layout</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">plot_layout</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>

        <span class="c1"># Create a placeholder widget to hold our toolbar and canvas.</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#--------------------------end of layouts/widgets initialization------------#</span>
        
        <span class="c1">#configure canvas axes and viewing window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
        <span class="n">xr</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">)]</span>
        <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ylims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="c1">#---------------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>


        
        <span class="c1">#connect keyboard events to the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ClickFocus</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ontype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onclick</span><span class="p">)</span>

        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cellchanged</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="mainWindow.onclick"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.onclick">[docs]</a>    <span class="k">def</span> <span class="nf">onclick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Mouse click</span>
<span class="sd">            Left == 1; Right == 3</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1">#Manual mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manT</span> <span class="o">=</span> <span class="n">Manual_Transition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

        
    <span class="c1">#keyboard events</span>
<div class="viewcode-block" id="mainWindow.ontype"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.ontype">[docs]</a>    <span class="k">def</span> <span class="nf">ontype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">zabs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="c1"># when the user hits &#39;r&#39;: clear the axes (except flux and error) and return to the initial x&amp;y lims</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="c1">#del self.ax.lines[2:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>

            <span class="c1">#self.ax.texts = []</span>
            <span class="c1">#while self.ax.texts:</span>
            <span class="c1">#    self.ax.texts.pop()</span>
            <span class="c1">#while self.ax.collections:</span>
            <span class="c1">#    self.ax.collections.pop()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_ylims</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_xlims</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
        <span class="c1">#another refresh to keep the current flux values but remove the plotted lines</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="k">pass</span>
            <span class="c1">#self.ax.texts = []</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>


            <span class="c1"># Give initial axes limits</span>
<span class="c1">#             self.ax.set_ylim(self.init_ylims)</span>
<span class="c1">#             self.ax.set_xlim(self.init_xlims)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="c1">#         # Set top y max</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 
<span class="c1">#         # Set top y min</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 
<span class="c1">#         # Smooth spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">Filter_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_error</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>  
<span class="c1">#         #Unsmooth Spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;U&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">Filter_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span><span class="c1">#medfilt(flux,np.int(Filter_size))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_error</span> <span class="o">=</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">Box1DKernel</span><span class="p">(</span><span class="n">Filter_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specplot</span><span class="p">()</span>
    
        <span class="c1"># Set X max</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 
        <span class="c1"># Set x min</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 

        <span class="c1"># Set pan spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;]&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">delx</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delx</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 
        <span class="c1"># Set pan spectrum</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;[&#39;</span><span class="p">:</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">delx</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">delx</span><span class="p">,</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">Windowname</span><span class="o">=</span><span class="s1">&#39;Manual y-Limits&#39;</span>
            <span class="n">instruction</span><span class="o">=</span><span class="s1">&#39;Input range (e.g. 0.,2.)&#39;</span>
            <span class="n">ylim</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Windowname</span><span class="p">,</span><span class="n">instruction</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">ylimit</span> <span class="o">=</span> <span class="n">ylim</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">ylimit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ylimit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;H&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">HelpWindow</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="c1">#first check if absorber linelist has already been catologed.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                
                <span class="c1">#if so, ask user if they would like to re-eval the results</span>
                <span class="n">buttonReply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;Reevaluate&quot;</span> <span class="p">,</span><span class="s2">&quot;Current Zabs LineList already evaluated: Reevaluate and overwrite?&quot;</span><span class="p">,</span>
                                                   <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">buttonReply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ion_selection</span> <span class="o">=</span> <span class="n">vStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span>
                    
            <span class="c1">#otherwise, proceed without manual consent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ion_selection</span> <span class="o">=</span> <span class="n">vStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span>
                


        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;j&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manT</span> <span class="o">=</span> <span class="n">Manual_Transition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            

        <span class="c1"># Compute Equivalent Width between two points</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="c1">#ekeycounts +=1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

    
            <span class="c1"># Keep running tab of all E clicks</span>
            <span class="n">eclick</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">);</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EW_pt&#39;</span><span class="p">,</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="c1">#self.fig.canvas.draw()</span>

            <span class="k">if</span> <span class="n">eclick</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Check if the wave entries are monotonously increasing</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                
                <span class="c1">#calculate and display column density if EW measurement intersects a line</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fval</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">wrest</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>
                                <span class="n">fval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;fval&#39;</span><span class="p">])</span>
                                <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;ion&#39;</span><span class="p">])</span>
                                <span class="n">wrest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;wrest&#39;</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="c1">#if only one line is intersected, use that transitions values</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">vel_lims</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">])</span><span class="o">-</span><span class="n">wrest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">wrest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
                        <span class="n">EW</span><span class="p">,</span><span class="n">sig_EW</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Nerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">[</span><span class="n">tab</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="n">fval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wrest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                        <span class="n">sig_EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
                        <span class="n">Wval</span> <span class="o">=</span> <span class="s1">&#39;EW [mAA]: &#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EW</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sig_EW</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                        <span class="n">logNerr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="n">Nerr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">Nerr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
                        <span class="n">formatName</span> <span class="o">=</span> <span class="s1">&#39;$N_{&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span>
                        <span class="n">logN</span> <span class="o">=</span> <span class="n">Wval</span> <span class="o">+</span> <span class="s1">&#39;log &#39;</span> <span class="o">+</span> <span class="n">formatName</span> <span class="o">+</span> <span class="s1">&#39; [$cm^{-2}$]:&#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span><span class="n">logNerr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">])</span><span class="o">+</span><span class="mf">.05</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">logN</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">Wval</span> <span class="o">+</span> <span class="s1">&#39;N &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[1/cm^2]&#39;</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span><span class="n">logNerr</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
                        
                    <span class="c1">#otherwise, ask user which transition they would like to use</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">fval</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fvals</span> <span class="o">=</span> <span class="n">fval</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fval_wrest</span> <span class="o">=</span> <span class="n">wrest</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fval_name</span> <span class="o">=</span> <span class="n">name</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">popup</span> <span class="o">=</span> <span class="n">Popup_col_density</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                        
                    <span class="c1"># if no lines are intersected only use EW</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">EW</span><span class="p">,</span><span class="n">sig_EW</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">wave_slice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">[</span><span class="n">tab</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                        <span class="n">sig_EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>

                        <span class="n">Wval</span><span class="o">=</span><span class="s1">&#39;EW [mAA]: &#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EW</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sig_EW</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">Wval</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">Wval</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
                        
                <span class="c1">#if no transitions plotted only evaluate EW </span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">EW</span><span class="p">,</span><span class="n">sig_EW</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">wave_slice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">tab</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">[</span><span class="n">tab</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
                    <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                    <span class="n">sig_EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>

                    <span class="n">Wval</span><span class="o">=</span><span class="s1">&#39;EW [mAA]: &#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EW</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sig_EW</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">Wval</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">Wval</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>

                
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 

         <span class="c1"># Fit a Gaussian</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;G&#39;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
    
            <span class="n">fclick</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">)</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EW_pt&#39;</span><span class="p">,</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> 

            

            <span class="c1">#Start Fitting</span>
            <span class="k">if</span> <span class="n">fclick</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Fit the data using a Gaussian</span>
                <span class="n">g_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">fit_g</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">LevMarLSQFitter</span><span class="p">()</span>

                <span class="c1"># First fit a quick continuum</span>
                <span class="n">qtq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="p">)))</span>
                <span class="n">ww</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>                 
                <span class="n">flux1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>
                <span class="n">spline</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">continuum</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">spline</span><span class="p">)</span>
    
                <span class="c1"># Check if it is an absorption or emission line</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="mf">1.</span><span class="o">-</span> <span class="p">(</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span><span class="p">)</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">fit_g</span><span class="p">(</span><span class="n">g_init</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                    <span class="n">Final_fit</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">g</span><span class="p">(</span><span class="n">ww</span><span class="p">))</span><span class="o">*</span><span class="n">continuum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="p">(</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">fit_g</span><span class="p">(</span><span class="n">g_init</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                    <span class="n">Final_fit</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">g</span><span class="p">(</span><span class="n">ww</span><span class="p">))</span><span class="o">*</span><span class="n">continuum</span>         
    
                <span class="n">model_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">Final_fit</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>        
                <span class="n">values0</span><span class="o">=</span><span class="s1">&#39; Amp: &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span>  <span class="n">g</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
                <span class="n">values1</span><span class="o">=</span><span class="s1">&#39; Center: &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span>  <span class="n">g</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="n">values2</span><span class="o">=</span><span class="s1">&#39; Sig: &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span>  <span class="n">g</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 


                <span class="bp">self</span><span class="o">.</span><span class="n">message1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ww</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">values0</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ww</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">values1</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ww</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">values2</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>



                <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">values0</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">values1</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">values2</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> </div>


    
<div class="viewcode-block" id="mainWindow.compute_EW"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.compute_EW">[docs]</a>    <span class="k">def</span> <span class="nf">compute_EW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="n">flx</span><span class="p">,</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">err_flx</span><span class="p">,</span><span class="n">fval</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span><span class="n">wrest</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">qtq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span> <span class="n">lam</span> <span class="o">&gt;=</span> <span class="n">lam_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">lam</span> <span class="o">&lt;=</span> <span class="n">lam_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">ww</span><span class="o">=</span><span class="n">lam</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>  

        <span class="n">flux1</span><span class="o">=</span><span class="n">flx</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span>
        <span class="n">spline</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">lam_lim</span><span class="p">,</span><span class="n">lam_ylim</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">continuum</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">spline</span><span class="p">)</span>
        <span class="c1">#ax.plot(ww,continuum,&#39;k--&#39;)</span>
        <span class="n">sig_flx1</span><span class="o">=</span><span class="n">err_flx</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span><span class="o">/</span><span class="n">continuum</span>
        <span class="n">flux1</span><span class="o">=</span><span class="n">flux1</span><span class="o">/</span><span class="n">continuum</span>
        
        <span class="c1">#Removing any NAN values </span>
        <span class="n">sq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">flux1</span><span class="p">);</span>
        <span class="n">tmp_flx</span><span class="o">=</span><span class="n">sig_flx1</span><span class="p">[</span><span class="n">sq</span><span class="p">]</span>
        <span class="n">flux1</span><span class="p">[</span><span class="n">sq</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_flx</span>

        <span class="c1">#clip the spectrum. If the flux is less than 0+N*sigma, then we&#39;re saturated. Clip the flux array(to avoid inifinite optical depth) and set the saturated flag</span>
        <span class="n">sat_lim</span><span class="o">=-</span><span class="mf">.01</span>
        <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flux1</span><span class="o">&lt;=</span><span class="n">sat_lim</span><span class="p">);</span>
        <span class="n">tmp_flx</span><span class="o">=</span><span class="n">sig_flx1</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
        <span class="n">flux1</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_flx</span>
        <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flux1</span><span class="o">&lt;=</span><span class="mf">0.</span><span class="p">);</span>
        <span class="n">tmp_flx</span><span class="o">=</span><span class="n">sig_flx1</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">+</span><span class="mf">0.01</span>
        <span class="n">flux1</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_flx</span><span class="p">;</span>
        
        
        <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">flux1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">ww</span><span class="p">)</span>
        <span class="n">delw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">ww</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ww</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sig_w</span><span class="o">=</span><span class="n">delw</span><span class="o">*</span><span class="n">sig_flx1</span>
        <span class="n">sig_wtot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sig_w</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
        
        
        <span class="k">if</span> <span class="n">fval</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">:</span>
            <span class="n">lambda_r</span><span class="o">=</span><span class="p">(</span><span class="n">lam</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))[</span><span class="n">qtq</span><span class="p">]</span>
            <span class="n">vel</span> <span class="o">=</span> <span class="p">((</span><span class="n">lam</span><span class="o">-</span><span class="n">wrest</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">wrest</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)))[</span><span class="n">qtq</span><span class="p">]</span>
            <span class="n">f0</span><span class="o">=</span><span class="n">fval</span>
        <span class="c1">#compute apparent optical depth</span>
            <span class="n">Tau_a</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">flux1</span><span class="p">);</span>
            <span class="c1">#compute the median optical depth weighted velcity.</span>
            <span class="n">Tau50</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Tau_a</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Tau_a</span><span class="p">)</span>
            <span class="n">vel50</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">Tau50</span><span class="p">,</span><span class="n">vel</span><span class="p">)</span>
            <span class="n">del_vel_j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">vel</span><span class="p">);</span>
            <span class="n">del_vel_j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">del_vel_j</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">del_vel_j</span><span class="p">)</span>
            <span class="c1"># Column density per pixel as a function of velocity</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="n">Tau_a</span><span class="o">/</span><span class="p">((</span><span class="mf">2.654e-15</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span><span class="o">*</span><span class="n">lambda_r</span><span class="p">);</span><span class="c1"># in units cm^-2 / (km s^-1), SS91 </span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">nv</span><span class="o">*</span> <span class="n">del_vel_j</span><span class="c1"># column density per bin obtained by multiplying differential Nv by bin width </span>
            <span class="n">tauerr</span> <span class="o">=</span> <span class="n">err_flx</span><span class="p">[</span><span class="n">qtq</span><span class="p">]</span><span class="o">/</span><span class="n">flux1</span><span class="p">;</span>
            <span class="n">nerr</span> <span class="o">=</span> <span class="p">(</span><span class="n">tauerr</span><span class="o">/</span><span class="p">((</span><span class="mf">2.654e-15</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span><span class="o">*</span><span class="n">lambda_r</span><span class="p">))</span><span class="o">*</span><span class="n">del_vel_j</span><span class="p">;</span> 
            <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
            <span class="n">colerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">nerr</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">;</span>
            <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">EW</span><span class="p">,</span><span class="n">sig_wtot</span><span class="p">,</span><span class="n">continuum</span><span class="p">,</span><span class="n">ww</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">colerr</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EW</span><span class="p">,</span><span class="n">sig_wtot</span><span class="p">,</span><span class="n">continuum</span><span class="p">,</span><span class="n">ww</span></div>



            
    <span class="c1">#Update manager brings items from the active zabs layout (below canvas) to an entry in the zabs_manager</span>
<div class="viewcode-block" id="mainWindow.update_manager"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.update_manager">[docs]</a>    <span class="k">def</span> <span class="nf">update_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">linelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">linelist</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> 
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Zabs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="n">linelist</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_plots</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_temp</span><span class="p">)</span>
        
        <span class="c1">#if you&#39;re filling a final slot within the zabs manager, create another slot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">#set z</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">,</span><span class="mi">4</span><span class="p">))))</span>
                    <span class="c1">#set linelist</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                    <span class="c1">#set color</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
            <span class="n">Catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="c1">#             self.active_ion.setText(&#39; &#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1">#else populate the first empty slot without creating a new</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">,</span><span class="mi">4</span><span class="p">))))</span>
                    <span class="c1">#set linelist</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                    <span class="c1">#set color</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="c1">#                     self.active_ion.setText(&#39; &#39;)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="k">break</span></div>
                    
<div class="viewcode-block" id="mainWindow.Refreshed"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.Refreshed">[docs]</a>    <span class="k">def</span> <span class="nf">Refreshed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_ylims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_xlims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FXval</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FYval</span><span class="o">=</span><span class="p">[]</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="c1">#self.ax.texts = []</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1">#may need condition to change hide color to gray</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
    
<div class="viewcode-block" id="mainWindow.cellchanged"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.cellchanged">[docs]</a>    <span class="k">def</span> <span class="nf">cellchanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentColumn</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="mainWindow.zabs_changed"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.zabs_changed">[docs]</a>    <span class="k">def</span> <span class="nf">zabs_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Please input numerical redshift&quot;</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="mainWindow.saveCatalog_fn"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.saveCatalog_fn">[docs]</a>    <span class="k">def</span> <span class="nf">saveCatalog_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saving</span> <span class="o">=</span> <span class="n">SaveCatalog</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saving</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saving</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saving</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="mainWindow.LoadCatalog_fn"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.LoadCatalog_fn">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCatalog_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="n">LoadCatalog</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loading</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
    <span class="c1">#spec plot is connected to the smoothing/unsmoothing events</span>
    <span class="c1">#flux is always stored as ax.lines[0], error as ax.lines[1]. So we can add two new S/US plots</span>
    <span class="c1">#replace lines[0] and [1], then delete the last two lines added to the ax.lines list to keep the reference as [1] and [0]</span>
<div class="viewcode-block" id="mainWindow.specplot"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.specplot">[docs]</a>    <span class="k">def</span> <span class="nf">specplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">xlim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">replace_flux</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_spectrum</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">replace_error</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_error</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;pale_red&#39;</span><span class="p">],</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> </div>
        

    <span class="c1"># Read and draw linelist    </span>
<div class="viewcode-block" id="mainWindow.DrawLineList"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.DrawLineList">[docs]</a>    <span class="k">def</span> <span class="nf">DrawLineList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">hide</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Man_Transition</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throw_away</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#this is for &#39;Z&#39; functionality deletes all lines and plots a new line</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_remove</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)]</span>
            <span class="c1">#self.ax.texts = []</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">throw_away</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="c1">#HIDE PROCEDURE</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">][:]:</span>
                <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">][:]:</span>
                <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1"># REMOVE PROCEDURE</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
            <span class="c1">#remove lines from canvas</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">][:]:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">][:]:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
                
            <span class="c1">#delete line identifiers</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;copy error and cntrl f!&#39;</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1">#PLOT PROCEDURE (otherwise continue plotting)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">label</span>
            <span class="n">linecolor</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">color</span><span class="p">]</span>
            <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">xlim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_xlims</span>
            <span class="n">ylim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            
            <span class="n">tt_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">temp_plots</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
                    <span class="n">xdata</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)]</span>
                    <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.9</span><span class="p">))</span>
                    <span class="n">ydata</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">)</span>                    
                    <span class="n">tt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                    
                    <span class="c1">#append text and plot artist objects</span>
                    <span class="n">tt_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                    <span class="n">temp_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">tt_temp</span> <span class="o">=</span> <span class="n">tt_temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tt_temp</span><span class="p">)</span><span class="c1">#uneccessary do use additional id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_plots</span> <span class="o">=</span> <span class="n">temp_plots</span>
            <span class="c1">#if first zabs or new zabs</span>

            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throw_away</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Man_Transition</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_plots</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt_temp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="p">)</span>
            
            <span class="c1">#if replotting a zabs, then reindex its lines</span>
            <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">zabs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throw_away</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Man_Transition</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)):</span> <span class="c1">#maybe need the zabs update option to make sure nothing happens in the &#39;Z&#39; event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_plots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">tt_temp</span>
            <span class="c1">#need to store new text objects     </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">tt_temp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zabs_line_plot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>


<div class="viewcode-block" id="mainWindow.get_linelist"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.mainWindow.get_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">get_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;LLS&quot;</span><span class="p">,</span> <span class="s2">&quot;LLS Small&quot;</span><span class="p">,</span> <span class="s2">&quot;DLA&quot;</span><span class="p">,</span><span class="s2">&quot;LBG&quot;</span><span class="p">,</span><span class="s2">&quot;Gala&quot;</span><span class="p">,</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

        <span class="n">item</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select Linelist&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;Line Lists&quot;</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>            
        
        <span class="k">if</span> <span class="n">ok</span> <span class="ow">and</span> <span class="n">item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">item</span></div></div>


<div class="viewcode-block" id="Redshift_Guess"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Redshift_Guess">[docs]</a><span class="k">class</span> <span class="nc">Redshift_Guess</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">combo_lines</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">hide</span> <span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="manage_identified_absorbers"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers">[docs]</a><span class="k">class</span> <span class="nc">manage_identified_absorbers</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">250</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Zabs Manager&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">((</span><span class="s1">&#39;Line Lists&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;Color&#39;</span><span class="p">,</span><span class="s1">&#39;Plot&#39;</span><span class="p">,</span><span class="s1">&#39;Remove&#39;</span><span class="p">,</span><span class="s1">&#39;Hide&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#make longer color list</span>
        <span class="n">clrlist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">clr</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_options</span> <span class="o">=</span> <span class="n">clrlist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="c1">#[&#39;yellow&#39;,&#39;orange&#39;,&#39;red&#39;,&#39;green&#39;,&#39;white&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span><span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span><span class="s1">&#39;DLA&#39;</span><span class="p">,</span><span class="s1">&#39;LBG&#39;</span><span class="p">,</span><span class="s1">&#39;Gal&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_options</span><span class="p">:</span>
                <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">combo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1">#overwrites objectName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Hide&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span><span class="p">:</span>
                <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">combo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cellchanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identified_line</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractScrollArea</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

<div class="viewcode-block" id="manage_identified_absorbers.plot"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span><span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
        <span class="n">linelist</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">zabs</span> <span class="o">=</span> <span class="n">z</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Zabs&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="n">linelist</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
        <span class="k">elif</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#         elif parent.zabs in parent.zabs_list.Zabs.to_numpy():</span>

        <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#update text objects for removal/hiding</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">linelist</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#ensure entered redshift is visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        
        <span class="c1">#if the user has hidden the plot, turn hide background back to gray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
        <span class="c1">#need to write a function for making the table entries the below code is redundant</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">==</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#self.table.insertRow(self.table.rowCount())</span>
            
            <span class="n">combo_color</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_options</span><span class="p">:</span>
                <span class="n">combo_color</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">combo_color</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

<span class="c1">#             self.removebut.setObjectName(str(i))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Hide&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            <span class="n">combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span><span class="p">:</span>
                <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">combo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractScrollArea</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span></div>
            
            
    
            
<div class="viewcode-block" id="manage_identified_absorbers.hide"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span><span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="c1">#parent.abs_plot.table.currentRow()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
        <span class="n">linelist</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">linelist</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="manage_identified_absorbers.remove"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="c1">#get row of deleted zabs values</span>
        <span class="n">row</span><span class="p">,</span><span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
        
        <span class="c1">#need to remove the objects stored in canvas for plot/hide functionality with condition row_remove==True</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">row_remove</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">row_remove</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#remove from the line_list manager if user has stored</span>
        <span class="n">zabs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">zabs</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zabs</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">#remove from the table widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        
        <span class="c1">#remove from the zabs_manager</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">])</span></div>
        

<div class="viewcode-block" id="manage_identified_absorbers.cellchanged"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers.cellchanged">[docs]</a>    <span class="k">def</span> <span class="nf">cellchanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentColumn</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="manage_identified_absorbers.get_index"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.manage_identified_absorbers.get_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">focusWidget</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">row</span><span class="p">,</span><span class="n">column</span></div></div>
    
        



<div class="viewcode-block" id="Manual_Transition"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Manual_Transition">[docs]</a><span class="k">class</span> <span class="nc">Manual_Transition</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span><span class="s1">&#39;LLS Small&#39;</span><span class="p">,</span><span class="s1">&#39;DLA&#39;</span><span class="p">,</span><span class="s1">&#39;LBG&#39;</span><span class="p">,</span><span class="s1">&#39;Gal&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_change</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
    
        
        <span class="c1">#Obtain Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="s1">&#39;LLS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition_change</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="p">)</span>
        
        <span class="c1">#Need to obtain linelist</span>
<div class="viewcode-block" id="Manual_Transition.line_change"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Manual_Transition.line_change">[docs]</a>    <span class="k">def</span> <span class="nf">line_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;ion&#39;</span><span class="p">])</span></div>
            
<div class="viewcode-block" id="Manual_Transition.transition_change"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Manual_Transition.transition_change">[docs]</a>    <span class="k">def</span> <span class="nf">transition_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        
        <span class="k">del</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="c1">#parent.ax.texts = []</span>
        <span class="k">while</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        
        <span class="n">parent</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_ll</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
<span class="c1">#         parent.active_ion.setText(self.Transitions.currentItem().text())</span>
        <span class="n">lambda_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()]</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">lambda_rest</span> <span class="o">=</span> <span class="n">lambda_rest</span>
        
        <span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">parent</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span><span class="n">lambda_rest</span><span class="p">)</span><span class="o">/</span><span class="n">lambda_rest</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">active_zabs</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">combo_color_main</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span><span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Man_Transition</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


        
<div class="viewcode-block" id="Catalog"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Catalog">[docs]</a><span class="k">class</span> <span class="nc">Catalog</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">combo_color</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">combo_options</span><span class="p">:</span>
            <span class="n">combo_color</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">combo_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">manage_identified_absorbers</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="p">,</span><span class="n">parent</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">manage_identified_absorbers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="p">,</span><span class="n">parent</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Hide&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">manage_identified_absorbers</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="p">,</span><span class="n">parent</span><span class="p">))</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_options</span><span class="p">:</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">combo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plotbut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">removebut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">hidebut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractScrollArea</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">focusWidget</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span><span class="n">parent</span><span class="o">.</span><span class="n">manT</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span></div>

        
<div class="viewcode-block" id="SaveCatalog"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.SaveCatalog">[docs]</a><span class="k">class</span> <span class="nc">SaveCatalog</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
        
        <span class="c1">#set a timer after setting background green. Then close save window</span>
        <span class="k">def</span> <span class="nf">onsave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">method</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">if</span> <span class="n">parent_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">parent_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savebut</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line1</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">if</span> <span class="n">parent_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">parent_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savebut1</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line2</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">directory</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">LineLists</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LineLists</span> <span class="o">==</span> <span class="s1">&#39;Partial&#39;</span><span class="p">)):</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">directory</span><span class="o">/</span><span class="s1">&#39;LineList_Identified.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>


                <span class="n">file</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="s1">&#39;Absorber_Catalog.csv&#39;</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savebut2</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1">#         layout = QHBoxLayout()</span>
        
        <span class="c1">#if no linelists have been identified</span>
        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">buttonReply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;Missing Linelist&quot;</span> <span class="p">,</span><span class="s2">&quot;No Linelists have been obtained: Proceed?&quot;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">buttonReply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LineLists</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> 
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#if more absorbers in zabs manager than unique zabs in linelist manager</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">buttonReply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;Missing Linelist&quot;</span> <span class="p">,</span><span class="s2">&quot;Missing linelists for the cataloged absorbers, continue?&quot;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">buttonReply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LineLists</span> <span class="o">=</span> <span class="s1">&#39;Partial&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LineLists</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span><span class="s1">&#39;SpecPlot_Projects&#39;</span>
            
            <span class="c1">#layouts</span>
            <span class="n">main</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">layout1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">layout2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">layouts</span> <span class="o">=</span> <span class="p">[</span><span class="n">layout</span><span class="p">,</span><span class="n">layout1</span><span class="p">,</span><span class="n">layout2</span><span class="p">]</span>
            
            <span class="c1">#labels</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Absorber Catolog Save (formats accepted: .csv)&#39;</span><span class="p">)</span>
            <span class="n">label1</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Linelist Save (formats accepted: .txt, .log)&#39;</span><span class="p">)</span>
            <span class="n">label2</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Directory Save (enter parent folder, filename defaults: Absorber_Catolog.csv, Identified_Linelist.txt)&#39;</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">,</span><span class="n">label1</span><span class="p">,</span><span class="n">label2</span><span class="p">]</span>
            
            <span class="c1">#line edits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line1</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line2</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">directory</span> <span class="o">/</span> <span class="s1">&#39;Absorber_Catalog.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">directory</span> <span class="o">/</span> <span class="s1">&#39;Identified_Linelist.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line2</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">directory</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">line1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">line2</span><span class="p">]</span>
            
            <span class="c1">#save buttons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">onsave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut1</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">onsave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut2</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savebut2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">onsave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">savebuts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">savebut</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">savebut1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">savebut2</span><span class="p">]</span>
            
            <span class="c1">#create layout</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">main</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">layouts</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">layouts</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">savebuts</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">main</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">layouts</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                

            
            <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
            
        <span class="c1">#Tell user which absorbers dont have a linelist by marking the comboboxes in red background and close save window</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueSaving</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> <span class="c1">#and ((self.LineLists == &#39;Partial&#39;) or (self.LineLists == &#39;None&#39;)):</span>
            <span class="n">line_zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">manager_zabs</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
            <span class="c1"># for zabs in zabs manager that arent in line_list</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_zabs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">manager_zabs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">line_zabs</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : red&#39;</span><span class="p">)</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : red&#39;</span><span class="p">)</span>
    
                    <span class="c1">#setcellWidgetbackground color</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span> <span class="o">==</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : red&#39;</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : red&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1">#else close save window</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="LoadCatalog"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.LoadCatalog">[docs]</a><span class="k">class</span> <span class="nc">LoadCatalog</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="c1">#lay1= absorbercat.csv load; lay2= linelist.txt load; lay3=directory containing both load</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Enter Zabs Manager dir+file (AbsorberCatalog.csv is default)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Browse&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">browsefiles</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label1</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Enter Linelist dir+file (Identified_Linelist.txt is default)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry1</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse1</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Browse&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">browsefiles</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label2</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Enter Directory containing both&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry2</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse2</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Browse&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browse2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">browsefiles</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="c1">#Add widgets to layout</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label2</span><span class="p">]</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">entry1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">entry2</span><span class="p">]</span>
        <span class="n">browses</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">browse1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">browse2</span><span class="p">]</span>
        <span class="n">lays</span> <span class="o">=</span> <span class="p">[</span><span class="n">layout</span><span class="p">,</span><span class="n">layout1</span><span class="p">,</span><span class="n">layout2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labs</span><span class="p">)):</span>
            <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">labs</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">lays</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">entrys</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#             lays[ii].addWidget(buttons[ii])</span>
            <span class="n">lays</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">browses</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">lays</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        
        
        
        <span class="c1">#setAutoDefault registers &#39;enter&#39; to &quot;load&quot; function</span>
        <span class="c1">#this should correspond to which of the boxes are filled</span>
        <span class="c1">#self.button.setAutoDefault(True)</span>
<span class="c1">#         self.entry.returnPressed.connect(self.button.click)</span>
                                
<div class="viewcode-block" id="LoadCatalog.browsefiles"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.LoadCatalog.browsefiles">[docs]</a>    <span class="k">def</span> <span class="nf">browsefiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">method</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># get csv</span>
            <span class="n">fname</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open file&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&quot;CSV files (*csv)&quot;</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="c1">#Populate zabs list and hide plots</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_zabs_manager</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            
            
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#get txt</span>
            <span class="n">fname</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open file&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&quot;Text files (*txt *.log)&quot;</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_identified_lines</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;Open a folder&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">),</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirs</span><span class="p">):</span>
            <span class="c1">#read in zabs manager</span>
                <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">populate_zabs_manager</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="c1">#read in linelist manager</span>
                <span class="k">elif</span> <span class="n">files</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">):</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_identified_lines</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="LoadCatalog.populate_zabs_manager"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.LoadCatalog.populate_zabs_manager">[docs]</a>    <span class="k">def</span> <span class="nf">populate_zabs_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">zabs</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">green_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>       
            <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;=</span> <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
                <span class="c1">#Catalog class create the new zabs_manager rows</span>
                <span class="n">Catalog</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                
            <span class="c1">#Fill the newly created rows with saved values</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">ii</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">zabs</span> <span class="o">=</span> <span class="n">zabs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">zabs</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">DrawLineList</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">remove</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">green_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="n">Catalog</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="LoadCatalog.plot_identified_lines"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.LoadCatalog.plot_identified_lines">[docs]</a>    <span class="k">def</span> <span class="nf">plot_identified_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="c1">#if zabs_manager already loaded</span>
        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># clear plotted lines/text from zabs_manager such that the new lines for plot/remove/hide are same color as linelist</span>
            <span class="k">del</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:];</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_line_plot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#parent.ax.texts = [];</span>
            <span class="k">while</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">parent</span><span class="o">.</span><span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                <span class="c1">#for all lines at that redshift</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                    <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                    <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                    <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">color</span><span class="p">])</span>
                    <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[[]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">zabs_line_plot</span> <span class="o">=</span> <span class="p">[[]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                
            <span class="c1">#if linelist has absorbers that are not cataloged</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
                <span class="n">zabs_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">line_list_zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">line_list_zabs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zabs_list</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                            <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                            <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                            <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">tt_all</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">temp_plot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">green_index</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="n">parent</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>
   
                
<div class="viewcode-block" id="HelpWindow"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.HelpWindow">[docs]</a><span class="k">class</span> <span class="nc">HelpWindow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HelpWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">850</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">HELP</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="Identified_plotter"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Identified_plotter">[docs]</a><span class="k">class</span> <span class="nc">Identified_plotter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : red&#39;</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No transitions have been identified&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if active remove plots and set indicator back to gray</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="p">:</span>
                    <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="p">:</span>
                    <span class="n">ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1">#else </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">identified_line_active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                            <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                            <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                            <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="n">color</span><span class="p">])</span>
                            <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>

                
                    <span class="c1">#if linelist has absorbers that are not cataloged</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
                        <span class="n">zabs_list</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">line_list_zabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">line_list_zabs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zabs_list</span><span class="p">:</span>
                                <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                                <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                                    <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                                    <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                                    <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                                    <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                                    <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                                    <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Wave_obs</span><span class="p">]</span>
                        <span class="c1">#ylow = np.interp(xdata[0],parent.wave,parent.flux)+.75</span>
                        <span class="n">lineplot</span><span class="p">,</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                        <span class="n">tt</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">0.75</span><span class="o">*</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s1">&#39;  z=&#39;</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Zabs</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">identified_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineplot</span><span class="p">)</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">identified_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                                    
                <span class="n">parent</span><span class="o">.</span><span class="n">Identified_line_plot</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : green&#39;</span><span class="p">)</span>        
            <span class="n">parent</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
                
                
                
<span class="c1">#---------------for Vstack---------------------#</span>

<div class="viewcode-block" id="prepare_absorber_object"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.prepare_absorber_object">[docs]</a><span class="k">def</span> <span class="nf">prepare_absorber_object</span><span class="p">(</span><span class="n">z_abs</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">line_flg</span><span class="o">=</span><span class="s1">&#39;LLS&#39;</span><span class="p">,</span><span class="n">vlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">]):</span>
    
    <span class="c1"># Read the full linelist</span>
    <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">read_line_list</span><span class="p">(</span><span class="n">line_flg</span><span class="p">)</span>
    <span class="n">wavelist</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">wavelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;wrest&#39;</span><span class="p">])</span>
        
        
    <span class="n">wavelist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelist</span><span class="p">)</span>

    
    <span class="c1"># select the lines within the wavelength range only</span>
    <span class="n">q</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">wavelist</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">z_abs</span><span class="p">))</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">wavelist</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">z_abs</span><span class="p">))));</span>
    
    <span class="c1"># Total transitions visible within the wavelength window</span>
    <span class="n">nTot</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    
    <span class="n">wavelist_selected</span><span class="o">=</span><span class="n">wavelist</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
    
    <span class="n">absys</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">Absorber</span><span class="p">(</span><span class="n">z_abs</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">wavelist_selected</span><span class="p">),</span><span class="n">window_lim</span><span class="o">=</span><span class="n">vlim</span><span class="p">,</span><span class="n">nofrills</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
    
    <span class="k">return</span> <span class="n">absys</span><span class="o">.</span><span class="n">ions</span></div>
    

<div class="viewcode-block" id="vStack"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.vStack">[docs]</a><span class="k">class</span> <span class="nc">vStack</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">line_flg</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1000.</span><span class="p">,</span><span class="mf">1000.</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_canvas</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zabs</span><span class="o">=</span><span class="n">zabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vlim</span><span class="o">=</span><span class="n">vlim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="o">=</span><span class="n">prepare_absorber_object</span><span class="p">(</span><span class="n">zabs</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">line_flg</span><span class="o">=</span><span class="n">line_flg</span><span class="p">)</span>
        <span class="c1">#-----full spectra properties---------#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="s1">&#39;z&#39;</span><span class="p">];</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="s1">&#39;wave&#39;</span><span class="p">];</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
        
               
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># last item is the full target spectrum</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">))</span>
        <span class="c1">#Flag to know if it is a detection or not</span>
        <span class="c1">#Set everything by default to non-detection</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        
        
        <span class="c1">#-----Sorting out how many pages are needed---------#</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">=</span><span class="mi">12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npages</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nions</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">))</span>
        <span class="c1"># calculate number of pages needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npages</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">npages</span> <span class="o">+=</span> <span class="mi">1</span>
        
        
        <span class="n">fig</span><span class="o">=</span> <span class="n">Figure</span><span class="p">()</span><span class="c1">#figure(figsize=(12,8))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vPlot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasQTAgg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ClickFocus</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onkb</span><span class="p">)</span>
        
        <span class="n">parent</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span><span class="c1">#FigureCanvasQTAgg(self.fig))</span>


<div class="viewcode-block" id="vStack.onkb"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.vStack.onkb">[docs]</a>    <span class="k">def</span> <span class="nf">onkb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="c1">#set up custom y-limit</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
                <span class="n">i</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">Windowname</span><span class="o">=</span><span class="s1">&#39;Manual y-Limits&#39;</span>
                <span class="n">instruction_text</span><span class="o">=</span><span class="s1">&#39;Input range (e.g. 0.,2.)&#39;</span>
                <span class="c1">#temp=input_txt_dlg(Windowname,instruction_text)</span>
                <span class="c1">#print(temp)</span>
                <span class="c1">#yrangetext=temp.filename</span>
                <span class="c1">#yrange = yrangetext.split(&#39;,&#39;)</span>
                <span class="c1">#yrange = np.array(yrange).astype(&#39;float32&#39;)</span>
                <span class="n">ylim</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span><span class="n">Windowname</span><span class="p">,</span><span class="n">instruction_text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                    <span class="n">ylimit</span> <span class="o">=</span> <span class="n">ylim</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">ylimit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ylimit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vPlot</span><span class="p">(</span><span class="n">ploti</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span><span class="p">[</span><span class="n">ylimit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylimit</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                
        <span class="c1">#page right</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">npages</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vPlot</span><span class="p">()</span>
        <span class="c1">#page left</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">-=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npages</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vPlot</span><span class="p">()</span>
            
        <span class="c1">#Toggle between detection-non-detection or blended    </span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="c1">#Detected,non-detected, blended-detection </span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
                <span class="n">i</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#set up a dumb toggling cycle</span>
                <span class="n">temp_flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

                <span class="k">if</span> <span class="n">temp_flag</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">temp_flag</span> <span class="o">=</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="n">temp_flag</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">temp_flag</span><span class="o">==</span><span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp_flag</span><span class="o">=</span><span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">temp_flag</span><span class="c1">#</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vPlot</span><span class="p">(</span><span class="n">ploti</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
        <span class="c1">#save linelist</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="c1">#reinsert the primary spectrum canvas to the mainlayout for keyboard functionality</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            
            <span class="c1">#Need to check if it is reevaluating a linelist, if so delete all lines with same &#39;zabs&#39; value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zabs_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">Zabs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span> <span class="ow">in</span> <span class="n">zabs_list</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="s1">&#39;Zabs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="c1"># based on line evaluation, add lines to the overall zabs manager linelist (&#39;flag=1&#39; is detected lines to add)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">wave_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lam_0_z&#39;</span><span class="p">]</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                    <span class="n">zabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
                    <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Wave_obs&#39;</span><span class="p">:</span> <span class="n">wave_obs</span><span class="p">,</span> <span class="s1">&#39;Zabs&#39;</span><span class="p">:</span> <span class="n">zabs</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    
            <span class="c1">#lets keep zabs_list sorted by ascending zabs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Zabs&#39;</span><span class="p">)</span>
            
            <span class="c1">#close to canvas so spectrum canvas is again visible</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="c1">#after quitting save function, lineList and color will be red for unsaved lines, check and replace if saving a missing linelist</span>
            
            <span class="c1">#first need to find row</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs_list</span><span class="o">.</span><span class="n">Zabs</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># red is #ff0000, if not red it will have no palette so this will need to be a try/pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">palette</span><span class="p">()</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Background</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;#ff0000&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">abs_plot</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color : QColor(53, 53, 53)&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span></div>
<div class="viewcode-block" id="vStack.vPlot"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.vStack.vPlot">[docs]</a>    <span class="k">def</span> <span class="nf">vPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ploti</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span><span class="c1">#spec,i=0):</span>
        <span class="c1"># global axesR</span>
        <span class="k">if</span> <span class="n">ploti</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ploti</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nions</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ploti</span><span class="o">=</span><span class="p">[</span><span class="n">ploti</span><span class="p">]</span>





        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ploti</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotstuff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span><span class="n">yrange</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="vStack.plotstuff"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.vStack.plotstuff">[docs]</a>    <span class="k">def</span> <span class="nf">plotstuff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span><span class="p">]</span>
        <span class="c1">#---------------Define variables for readability--------------#</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;wave&#39;</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">window_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;window_lim&#39;</span><span class="p">]</span>
        <span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="c1"># Set a title giving the page number</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotppage</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Page &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npages</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;teal&#39;</span><span class="p">])</span>


        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span><span class="n">flux</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">flux</span><span class="p">),</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;teal&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span><span class="n">error</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">flux</span><span class="p">),</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;orange2&#39;</span><span class="p">])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;light_gray&#39;</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;light_gray&#39;</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.815</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.815</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;f0: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">comment</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.815</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;teal&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">yrange</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>

        
        <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#Display some measurement</span>
            <span class="n">textout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotText</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">textcolor</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textcolor</span><span class="o">=</span><span class="n">clr</span><span class="p">[</span><span class="s1">&#39;light_gray&#39;</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">textout</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">textcolor</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="vStack.plotText"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.vStack.plotText">[docs]</a>    <span class="k">def</span> <span class="nf">plotText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flag</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Detection&#39;</span>       
        <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Non-Detection&#39;</span>      
        <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span><span class="s1">&#39;Blended-detection&#39;</span>
        <span class="k">return</span> <span class="n">text</span></div></div>

<span class="c1">#Initial inputs and callable class to run proram        </span>
<div class="viewcode-block" id="input_txt_dlg"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.input_txt_dlg">[docs]</a><span class="k">class</span> <span class="nc">input_txt_dlg</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Windowname</span><span class="p">,</span><span class="n">instruction</span><span class="p">,</span><span class="n">default_text</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">main</span> <span class="o">=</span> <span class="n">popup_windows</span><span class="p">(</span><span class="n">Windowname</span><span class="p">,</span><span class="n">instruction</span><span class="p">,</span><span class="n">default_text</span><span class="o">=</span><span class="n">default_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>        </div>
        
        
<div class="viewcode-block" id="Popup_col_density"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Popup_col_density">[docs]</a><span class="k">class</span> <span class="nc">Popup_col_density</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="c1">#creates popup displaying the multiple transitions encompassed by EW</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Select Transition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">fvals</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">fval_name</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">itemDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ion_selected</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
    
    <span class="c1">#</span>
<div class="viewcode-block" id="Popup_col_density.ion_selected"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.Popup_col_density.ion_selected">[docs]</a>    <span class="k">def</span> <span class="nf">ion_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">item_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">vel_lims</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">tab</span><span class="p">])</span><span class="o">-</span><span class="n">parent</span><span class="o">.</span><span class="n">fval_wrest</span><span class="p">[</span><span class="n">item_idx</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span><span class="o">*</span><span class="n">parent</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">fval_wrest</span><span class="p">[</span><span class="n">item_idx</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">))</span>
        <span class="n">EW</span><span class="p">,</span><span class="n">sig_EW</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Nerr</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">compute_EW</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">parent</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">tab</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">parent</span><span class="o">.</span><span class="n">zabs</span><span class="p">),</span><span class="n">parent</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">tab</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="n">parent</span><span class="o">.</span><span class="n">fvals</span><span class="p">[</span><span class="n">item_idx</span><span class="p">],</span><span class="n">parent</span><span class="o">.</span><span class="n">fval_wrest</span><span class="p">[</span><span class="n">item_idx</span><span class="p">])</span>
        <span class="n">EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
        <span class="n">sig_EW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_EW</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_slice</span><span class="p">,</span><span class="n">cont</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
        <span class="n">Wval</span> <span class="o">=</span> <span class="s1">&#39;EW [mAA]: &#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EW</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sig_EW</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">logNerr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="n">Nerr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">Nerr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">formatName</span> <span class="o">=</span> <span class="s1">&#39;$N_{&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">.</span><span class="n">fval_name</span><span class="p">[</span><span class="n">item_idx</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span>
        <span class="n">logN</span> <span class="o">=</span> <span class="n">Wval</span> <span class="o">+</span> <span class="s1">&#39;log &#39;</span> <span class="o">+</span> <span class="s1">&#39; [$cm^{-2}$]: &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span><span class="n">logNerr</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">parent</span><span class="o">.</span><span class="n">lam_lim</span><span class="p">])</span><span class="o">+</span><span class="mf">.05</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">lam_ylim</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="n">logN</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">message_window</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">logN</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">lam_lim</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">lam_ylim</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>
        
     
        
<span class="c1">#--------------------initialization of Application-----------------</span>
<div class="viewcode-block" id="rb_plotspec"><a class="viewcode-back" href="../../../rbcodes.GUIs.html#rbcodes.GUIs.PlotSpec_Integrated.rb_plotspec">[docs]</a><span class="k">class</span> <span class="nc">rb_plotspec</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">zabs</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">():</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="s2">&quot;Fusion&quot;</span><span class="p">)</span>

            <span class="c1"># Now use a palette to switch to dark colors:</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="n">QPalette</span><span class="p">()</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">WindowText</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>        
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">AlternateBase</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">ButtonText</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">BrightText</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Link</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">218</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Highlight</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">218</span><span class="p">))</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
    
            <span class="n">app</span><span class="o">.</span><span class="n">setPalette</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> 



        <span class="c1">#app = QtWidgets.QApplication(sys.argv)</span>
         <span class="c1"># Force the style to be the same on all OSs:</span>
        <span class="n">main</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1700</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span>
        
        <span class="c1">#Center app on initialization</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">frameGeometry</span><span class="p">()</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">QDesktopWidget</span><span class="p">()</span><span class="o">.</span><span class="n">availableGeometry</span><span class="p">()</span><span class="o">.</span><span class="n">center</span><span class="p">()</span>
        <span class="n">qr</span><span class="o">.</span><span class="n">moveCenter</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">qr</span><span class="o">.</span><span class="n">topLeft</span><span class="p">())</span>
        
        <span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setQuitOnLastWindowClosed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">rbcodes 0.1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rbcodes.GUIs.PlotSpec_Integrated</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Rongmon Bordoloi.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>